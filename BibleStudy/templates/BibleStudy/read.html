{% extends 'Users/base.html' %}
{% load custom_filters %}
{% block content %}

<br><br><br><br>

<div class="content-container" >
  <div class="read-container">
    <br><br>
    <div class="group-button">
    <div class="dropdown">
      <button class="btn btn-dark dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" style="max-width: 300px;overflow: hidden;">
        {{ bible_id }}
      </button>
      <ul class="dropdown-menu dropdown-menu-dark">
        {% for version in versions %}
          <li ><a class="dropdown-item" href="{% url 'read' version book chapter %}">{{ version }}</a></li>
        {% endfor %}
        
      </ul>
    </div>

    <div class="dropdown" style="padding-left: 10px;">
      <button class="btn btn-dark dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
        {{ book }}
      </button>
      <ul class="dropdown-menu dropdown-menu-dark">
        {% for book_name in books %}
          <li ><a class="dropdown-item" href="{% url 'read' bible_uid book_name chapter %}">{{ book_name }}</a></li>
        {% endfor %}
        f
      </ul>
    </div>

    <div class="dropdown" style="padding-left: 10px;">
      <button class="btn btn-dark dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
        {{ chapter }}
      </button>
      <ul class="dropdown-menu dropdown-menu-dark">
        {% for chapter in chapters %}
          <li ><a class="dropdown-item" href="{% url 'read' bible_uid book chapter.order %}">{{ chapter.order }}</a></li>
        {% endfor %}
        
      </ul>
    </div>
    </div>
    <br><br>
    

    <br>
    

    
     

    

<div class="read-view">
  <div class="text-center">
    {% save_passes_test user book chapter as status %}
      {% if status == None %}
      <button class="btn btn-secondary" href="#" disabled>Book Complete</button>
      {% elif status == True %}
        <a class="btn btn-info" href="{% url 'save-progress' chapter_id %}">Save</a>
      {% elif status == "Saved" %}
        <a class="btn btn-info" href="{% url 'save-progress' chapter_id %}">Already Saved</a>
      {% else %}
        <button class="btn btn-danger" href="#" disabled>To Save Progress Follow Order</button>
      {% endif %}
  
</div>
<br><br>

    <p class="p" onclick="showPopup('{{ verse.verse }}')" >{{ data|safe }}</p>
  
  




    

</div>


</div>




<script>
  // Get all elements with class 'v'
  var verses = document.querySelectorAll('.v');

  // Add click event listener to each element
  verses.forEach(function (verse) {
      verse.addEventListener('click', function () {
          // Show a browser alert with data-number content
          showAlert(verse.getAttribute('data-number'));

          // Send AJAX request
          sendAjaxRequest(verse.getAttribute('data-number'));
      });
  });

  // Function to show a browser alert
  function showAlert(content) {
      alert('Verse: ' + content);
  }

  // Function to send an AJAX request
  function sendAjaxRequest(dataNumber) {
      // URL for creating a bookmark
      var url =  '{% url "bookmark" %}';

      // Data to be sent in the request
      var data = {
          verse_id: dataNumber,
          user:'{{ user }}',
          book:'{{ book }}',
          chapter:'{{ chapter }}',
          user:'{{ user }}',
          // Add more variables as needed
      };

      // Send a POST request with the data using jQuery
      $.ajax({
          url: url,
          type: 'POST',
          headers: {
              'X-CSRFToken': getCookie('csrftoken'),  // Include CSRF token in the header
          },
          data: data,
          success: function(response) {
              console.log('Bookmark created:', response);
          },
          error: function(error) {
              console.error('Error creating bookmark:', error);
          }
      });
  }

  // Function to get CSRF token from cookies
  function getCookie(name) {
      var cookieValue = null;
      if (document.cookie && document.cookie !== '') {
          var cookies = document.cookie.split(';');
          for (var i = 0; i < cookies.length; i++) {
              var cookie = cookies[i].trim();
              // Check if the cookie name matches with the provided name
              if (cookie.substring(0, name.length + 1) === (name + '=')) {
                  cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                  break;
              }
          }
      }
      return cookieValue;
  }
</script>







</div>





{% endblock %}